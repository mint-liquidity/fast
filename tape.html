<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MINT | The Tape</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --mint-navy: #0B0D11;
            --mint-navy-light: #12151A;
            --mint-navy-lighter: #1A1E25;
            --mint-gray: #3B4046;
            --mint-gray-light: #6B7280;
            --mint-gray-lighter: #9CA3AF;
            --mint-white: #D1D5DB;
            --mint-text: #B0B7C0;
            --mint-text-bright: #E5E7EB;
            --mint-green: #5A9A7C;
            --mint-green-dim: rgba(90, 154, 124, 0.15);
            --mint-red: #C45A5A;
            --mint-red-dim: rgba(196, 90, 90, 0.15);
            --mint-blue: #007AFF;
            --surface-base: #0B0D11;
            --surface-card: #12151A;
            --surface-elevated: #1A1E25;
            --border-subtle: rgba(255, 255, 255, 0.06);
            --border-medium: rgba(255, 255, 255, 0.10);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--surface-base);
            color: var(--mint-white);
            line-height: 1.5;
            min-height: 100vh;
        }

        .mono { font-family: 'JetBrains Mono', 'SF Mono', monospace; }

        /* Navigation Bar */
        .mint-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 24px;
            background: var(--surface-card);
            border-bottom: 1px solid var(--border-subtle);
        }
        .mint-nav-left { display: flex; align-items: center; gap: 32px; }
        .mint-nav-logo { font-size: 15px; font-weight: 600; color: var(--mint-text-bright); letter-spacing: 0.3px; }
        .mint-nav-tabs { display: flex; gap: 8px; }
        .nav-tab {
            padding: 10px 24px;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.8px;
            text-transform: uppercase;
            color: var(--mint-gray-light);
            background: transparent;
            border: 1px solid var(--border-subtle);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.15s;
            text-decoration: none;
        }
        .nav-tab:hover { border-color: var(--mint-gray); color: var(--mint-text-bright); }
        .nav-tab.active { color: var(--mint-text-bright); background: var(--surface-elevated); border-color: var(--mint-text); }

        .nav-right { display: flex; align-items: center; gap: 16px; font-size: 11px; color: var(--mint-gray-light); }

        /* Demo Narration */
        .demo-narration {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 14px 24px;
            background: var(--surface-card);
            border-bottom: 1px solid var(--border-subtle);
        }
        .demo-narration-icon { color: var(--mint-green); font-size: 14px; }
        .demo-narration-content { flex: 1; }
        .demo-narration-row { display: flex; align-items: center; gap: 12px; }
        .demo-label { font-size: 9px; font-weight: 700; color: var(--mint-green); text-transform: uppercase; letter-spacing: 1px; padding: 2px 6px; background: var(--mint-green-dim); border-radius: 2px; }
        .demo-text { font-size: 11px; color: var(--mint-gray-lighter); }
        .demo-narration-row.secondary { margin-top: 4px; }
        .demo-source { font-size: 10px; color: var(--mint-gray-light); font-family: 'JetBrains Mono', monospace; }
        .demo-narration-stats { display: flex; gap: 20px; }
        .demo-stat { text-align: center; }
        .demo-stat-value { font-size: 14px; font-weight: 700; color: var(--mint-text-bright); font-family: 'JetBrains Mono', monospace; }
        .demo-stat-label { font-size: 8px; color: var(--mint-gray-light); text-transform: uppercase; letter-spacing: 0.5px; }

        /* Main Container */
        .main-container { height: calc(100vh - 120px); padding: 20px 24px; }

        /* Production Grid */
        .production-container { height: 100%; display: flex; flex-direction: column; gap: 16px; }

        .obligor-tabs { display: flex; gap: 8px; flex-shrink: 0; }
        .obligor-tab {
            display: flex; align-items: center; gap: 8px;
            padding: 10px 20px;
            background: var(--surface-card);
            border: 1px solid var(--border-subtle);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.15s;
        }
        .obligor-tab:hover { border-color: var(--mint-gray); }
        .obligor-tab.active { background: var(--surface-elevated); border-color: var(--mint-text); }
        .obligor-ticker { font-size: 12px; font-weight: 700; color: var(--mint-text-bright); }
        .obligor-rating { font-size: 10px; color: var(--mint-gray-light); font-family: 'JetBrains Mono', monospace; }

        .production-grid {
            flex: 1;
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 16px;
            overflow: hidden;
        }

        /* Invoice List Panel */
        .invoice-list-panel {
            background: var(--surface-card);
            border: 1px solid var(--border-subtle);
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: var(--surface-elevated);
            border-bottom: 1px solid var(--border-subtle);
        }
        .panel-title { font-size: 10px; font-weight: 600; color: var(--mint-gray-light); text-transform: uppercase; letter-spacing: 0.8px; }
        .invoice-count { font-size: 11px; font-weight: 700; color: var(--mint-text-bright); font-family: 'JetBrains Mono', monospace; padding: 2px 8px; background: var(--surface-base); border-radius: 3px; }

        .invoice-list { flex: 1; overflow-y: auto; padding: 8px; }

        .invoice-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 14px;
            background: var(--surface-base);
            border: 1px solid var(--border-subtle);
            border-radius: 4px;
            margin-bottom: 6px;
            cursor: pointer;
            transition: all 0.15s;
        }
        .invoice-item:hover { border-color: var(--mint-gray); background: var(--surface-elevated); }
        .invoice-item.selected { border-color: var(--mint-green); background: rgba(90, 154, 124, 0.08); }
        .invoice-item.mismatch { border-left: 3px solid var(--mint-red); }
        .invoice-item.pending { opacity: 0.7; }

        .invoice-item-left { display: flex; flex-direction: column; gap: 2px; }
        .invoice-id { font-size: 12px; font-weight: 600; color: var(--mint-text-bright); }
        .invoice-supplier { font-size: 10px; color: var(--mint-gray-light); }

        .invoice-item-right { display: flex; flex-direction: column; align-items: flex-end; gap: 4px; }
        .invoice-amount { font-size: 13px; font-weight: 600; color: var(--mint-text-bright); font-family: 'JetBrains Mono', monospace; }
        .invoice-status-badge {
            font-size: 8px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 2px 6px;
            border-radius: 2px;
        }
        .invoice-status-badge.ready { background: var(--mint-green-dim); color: var(--mint-green); }
        .invoice-status-badge.mismatch { background: var(--mint-red-dim); color: var(--mint-red); }
        .invoice-status-badge.pending { background: rgba(107, 114, 128, 0.2); color: var(--mint-gray-lighter); }

        /* Comparison Panel */
        .comparison-panel {
            background: var(--surface-card);
            border: 1px solid var(--border-subtle);
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .comparison-header {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            padding: 16px 20px;
            background: var(--surface-elevated);
            border-bottom: 1px solid var(--border-subtle);
        }
        .source-column { display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .source-column.center { justify-content: center; }
        .source-icon { font-size: 16px; }
        .source-icon.oracle { color: #F59E0B; }
        .source-icon.supplier { color: var(--mint-green); }
        .source-label { font-size: 9px; font-weight: 700; color: var(--mint-gray-lighter); text-transform: uppercase; letter-spacing: 0.8px; }
        .source-system { font-size: 10px; color: var(--mint-text-bright); font-weight: 500; }
        .source-method { font-size: 9px; color: var(--mint-gray-light); font-family: 'JetBrains Mono', monospace; }

        .verification-badge {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 10px 16px;
            background: var(--surface-base);
            border: 1px solid var(--border-medium);
            border-radius: 4px;
        }
        .verification-badge.matched { border-color: var(--mint-green); background: var(--mint-green-dim); }
        .verification-badge.mismatch { border-color: var(--mint-red); background: var(--mint-red-dim); }
        .verification-icon { font-size: 14px; color: var(--mint-gray-light); }
        .verification-text { font-size: 9px; font-weight: 700; color: var(--mint-gray-lighter); text-transform: uppercase; letter-spacing: 0.5px; }
        .verification-badge.matched .verification-text { color: var(--mint-green); }
        .verification-badge.mismatch .verification-text { color: var(--mint-red); }

        .comparison-grid {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        .comparison-empty {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
            color: var(--mint-gray-light);
            font-size: 12px;
        }

        .comparison-category {
            padding: 8px 0 4px;
            margin-top: 12px;
        }
        .comparison-category:first-child { margin-top: 0; }
        .category-label { font-size: 9px; font-weight: 700; color: var(--mint-gray-light); text-transform: uppercase; letter-spacing: 1px; }

        .comparison-row {
            display: grid;
            grid-template-columns: 1fr 50px 1fr;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-subtle);
        }
        .comparison-cell { padding: 4px 8px; }
        .comparison-cell.oracle { background: rgba(245, 158, 11, 0.05); border-radius: 3px; }
        .comparison-cell.supplier { background: rgba(90, 154, 124, 0.05); border-radius: 3px; }
        .comparison-field { font-size: 9px; color: var(--mint-gray-light); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 2px; }
        .comparison-value { font-size: 11px; color: var(--mint-text-bright); font-family: 'JetBrains Mono', monospace; }
        .match-cell { display: flex; align-items: center; justify-content: center; }
        .match-indicator { font-size: 14px; font-weight: 700; }
        .match-indicator.pass { color: var(--mint-green); }
        .match-indicator.fail { color: var(--mint-red); }

        /* Verification Summary */
        .verification-summary {
            display: none;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            padding: 16px;
            background: var(--surface-elevated);
            border-top: 1px solid var(--border-subtle);
        }
        .verification-source { padding: 10px; background: var(--surface-base); border-radius: 4px; }
        .source-check { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; }
        .check-icon { width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; border-radius: 50%; font-size: 11px; font-weight: 700; background: var(--surface-elevated); color: var(--mint-gray-light); }
        .check-icon.confirmed { background: var(--mint-green); color: white; }
        .check-label { font-size: 10px; font-weight: 600; color: var(--mint-text-bright); }
        .source-detail { font-size: 9px; color: var(--mint-gray-light); margin-left: 28px; }

        /* Verification Footer */
        .verification-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: var(--surface-card);
            border-top: 1px solid var(--border-subtle);
        }
        .invoice-meta { display: none; gap: 20px; }
        .meta-item { display: flex; flex-direction: column; }
        .meta-label { font-size: 8px; color: var(--mint-gray-light); text-transform: uppercase; letter-spacing: 0.5px; }
        .meta-value { font-size: 12px; font-weight: 600; color: var(--mint-text-bright); font-family: 'JetBrains Mono', monospace; }
        .meta-value.accent { color: var(--mint-green); }

        .verify-btn {
            padding: 12px 24px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: var(--mint-green);
            color: var(--mint-navy);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.15s;
            margin-left: auto;
        }
        .verify-btn:hover { background: #4a8a6c; }
        .verify-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="mint-nav">
        <div class="mint-nav-left">
            <div class="mint-nav-logo">MINT</div>
            <div class="mint-nav-tabs">
                <a href="tape.html" class="nav-tab active">The Tape</a>
                <a href="checkpoint.html" class="nav-tab">Checkpoint</a>
                <a href="agents.html" class="nav-tab">Agents</a>
            </div>
        </div>
        <div class="nav-right">
            <span id="clock"></span>
        </div>
    </nav>

    <!-- Demo Narration -->
    <div class="demo-narration">
        <div class="demo-narration-icon">◉</div>
        <div class="demo-narration-content">
            <div class="demo-narration-row">
                <span class="demo-label">LIVE DATA</span>
                <span class="demo-text">Pulled directly from retailer Oracle ERP via OData API. Supplier confirmation via AS2/EDI.</span>
            </div>
            <div class="demo-narration-row secondary">
                <span class="demo-source">Source: Oracle ERP Cloud → MINT Extraction Agent → Triple Verification</span>
            </div>
        </div>
        <div class="demo-narration-stats">
            <div class="demo-stat">
                <span class="demo-stat-value">3</span>
                <span class="demo-stat-label">Sources</span>
            </div>
            <div class="demo-stat">
                <span class="demo-stat-value">13</span>
                <span class="demo-stat-label">Checks</span>
            </div>
            <div class="demo-stat">
                <span class="demo-stat-value">36ms</span>
                <span class="demo-stat-label">Latency</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-container">
        <div class="production-container">
            <!-- Obligor Tabs -->
            <div class="obligor-tabs">
                <button class="obligor-tab active" data-obligor="tjx" onclick="selectObligor('tjx')">
                    <span class="obligor-ticker">TJX</span>
                    <span class="obligor-rating">A-</span>
                </button>
                <button class="obligor-tab" data-obligor="olli" onclick="selectObligor('olli')">
                    <span class="obligor-ticker">OLLI</span>
                    <span class="obligor-rating">BBB+</span>
                </button>
                <button class="obligor-tab" data-obligor="rost" onclick="selectObligor('rost')">
                    <span class="obligor-ticker">ROST</span>
                    <span class="obligor-rating">BBB+</span>
                </button>
            </div>

            <div class="production-grid">
                <!-- Invoice List -->
                <div class="invoice-list-panel">
                    <div class="panel-header">
                        <span class="panel-title">Pending Invoices</span>
                        <span class="invoice-count" id="invoice-count">0</span>
                    </div>
                    <div class="invoice-list" id="invoice-list"></div>
                </div>

                <!-- Comparison Panel -->
                <div class="comparison-panel">
                    <div class="comparison-header">
                        <div class="source-column">
                            <div class="source-icon oracle">◉</div>
                            <div class="source-label">RETAILER ERP</div>
                            <div class="source-system" id="erp-system-label">Oracle ERP Cloud</div>
                            <div class="source-method">OData API</div>
                        </div>
                        <div class="source-column center">
                            <div class="verification-badge" id="verification-badge">
                                <span class="verification-icon">⟷</span>
                                <span class="verification-text" id="match-status-text">SELECT INVOICE</span>
                            </div>
                        </div>
                        <div class="source-column">
                            <div class="source-icon supplier">◉</div>
                            <div class="source-label">SUPPLIER EDI</div>
                            <div class="source-system">AS2 / SFTP</div>
                            <div class="source-method">EDI 810</div>
                        </div>
                    </div>

                    <div class="comparison-grid" id="comparison-grid">
                        <div class="comparison-empty">
                            Select an invoice to view triple verification
                        </div>
                    </div>

                    <div class="verification-summary" id="verification-summary">
                        <div class="verification-source">
                            <div class="source-check oracle">
                                <span class="check-icon" id="erp-check">○</span>
                                <span class="check-label">ERP Confirmed</span>
                            </div>
                            <div class="source-detail" id="erp-detail">Invoice exists in Oracle AP module</div>
                        </div>
                        <div class="verification-source">
                            <div class="source-check supplier">
                                <span class="check-icon" id="edi-check">○</span>
                                <span class="check-label">Supplier Confirmed</span>
                            </div>
                            <div class="source-detail" id="edi-detail">EDI 810 received via AS2</div>
                        </div>
                        <div class="verification-source">
                            <div class="source-check procurement">
                                <span class="check-icon" id="procurement-check">○</span>
                                <span class="check-label">Procurement Verified</span>
                            </div>
                            <div class="source-detail" id="procurement-detail">PO → GR → INV chain intact</div>
                        </div>
                    </div>

                    <div class="verification-footer">
                        <div class="invoice-meta" id="invoice-meta">
                            <div class="meta-item">
                                <span class="meta-label">Risk Score</span>
                                <span class="meta-value" id="meta-risk">--</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Yield</span>
                                <span class="meta-value accent" id="meta-yield">--</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Hash</span>
                                <span class="meta-value mono" id="meta-hash">--</span>
                            </div>
                        </div>
                        <button class="verify-btn" id="verify-btn" onclick="openCheckpoint()" disabled>
                            RUN CHECKPOINT
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Invoice Data
        const obligorData = {
            tjx: {
                name: 'TJX HG',
                ticker: 'TJX',
                rating: 'A-',
                erpSystem: 'Oracle ERP Cloud',
                invoices: [
                    { id: 'INV-77807', amount: 188700.00, supplier: 'SUP-2267', supplierName: 'Metro Freight LLC', status: 'ready', risk: 95, yield: 7.60, hash: '0x33774408', shipDate: '2026-01-10', deliveryConfirmed: true, oracle: { po: 'PO-88421', gr: 'GR-443222', amount: 188700.00, terms: 'NET 45', due: '2026-01-29' }, supplier_data: { po: 'PO-88421', gr: 'GR-443222', amount: 188700.00, terms: 'NET 45', due: '2026-01-29' }},
                    { id: 'INV-77808', amount: 245670.00, supplier: 'SUP-2267', supplierName: 'Metro Freight LLC', status: 'ready', risk: 95, yield: 7.40, hash: '0x00AABBCC', shipDate: '2026-01-12', deliveryConfirmed: true, oracle: { po: 'PO-88422', gr: 'GR-443223', amount: 245670.00, terms: 'NET 45', due: '2026-01-31' }, supplier_data: { po: 'PO-88422', gr: 'GR-443223', amount: 245670.00, terms: 'NET 45', due: '2026-01-31' }}
                ]
            },
            olli: {
                name: 'OLLI',
                ticker: 'OLLI',
                rating: 'BBB+',
                erpSystem: 'SAP S/4HANA',
                invoices: [
                    { id: 'INV-77809', amount: 423500.00, supplier: 'SUP-3378', supplierName: 'Apex Logistics Inc', status: 'ready', risk: 96, yield: 7.20, hash: '0x55AABBCC', shipDate: '2026-01-08', deliveryConfirmed: true, oracle: { po: 'PO-92301', gr: 'GR-501122', amount: 423500.00, terms: 'NET 45', due: '2026-02-01' }, supplier_data: { po: 'PO-92301', gr: 'GR-501122', amount: 423500.00, terms: 'NET 45', due: '2026-02-01' }},
                    { id: 'INV-77810', amount: 356780.00, supplier: 'SUP-3378', supplierName: 'Apex Logistics Inc', status: 'ready', risk: 95, yield: 7.40, hash: '0x77DDEEFF', shipDate: '2026-01-09', deliveryConfirmed: true, oracle: { po: 'PO-92302', gr: 'GR-501123', amount: 356780.00, terms: 'NET 30', due: '2026-01-30' }, supplier_data: { po: 'PO-92302', gr: 'GR-501123', amount: 356780.00, terms: 'NET 30', due: '2026-01-30' }},
                    { id: 'INV-77811', amount: 289340.00, supplier: 'SUP-3378', supplierName: 'Apex Logistics Inc', status: 'mismatch', risk: 94, yield: 7.60, hash: '0x99001122', shipDate: '2026-01-11', deliveryConfirmed: true, oracle: { po: 'PO-92303', gr: 'GR-501124', amount: 289340.00, terms: 'NET 45', due: '2026-02-05' }, supplier_data: { po: 'PO-92303', gr: 'GR-501124', amount: 289840.00, terms: 'NET 45', due: '2026-02-05' }},
                    { id: 'INV-77812', amount: 312890.00, supplier: 'SUP-3378', supplierName: 'Apex Logistics Inc', status: 'ready', risk: 95, yield: 7.30, hash: '0x22DDEEFF', shipDate: '2026-01-13', deliveryConfirmed: true, oracle: { po: 'PO-92304', gr: 'GR-501125', amount: 312890.00, terms: 'NET 45', due: '2026-02-08' }, supplier_data: { po: 'PO-92304', gr: 'GR-501125', amount: 312890.00, terms: 'NET 45', due: '2026-02-08' }},
                    { id: 'INV-77813', amount: 267890.00, supplier: 'SUP-3378', supplierName: 'Apex Logistics Inc', status: 'pending', risk: 94, yield: 7.50, hash: '0xCC8899BB', shipDate: '2026-01-14', deliveryConfirmed: true, oracle: { po: 'PO-92305', gr: 'GR-501126', amount: 267890.00, terms: 'NET 30', due: '2026-02-10' }, supplier_data: { po: 'PO-92305', gr: 'GR-501126', amount: 267890.00, terms: 'NET 30', due: '2026-02-10' }}
                ]
            },
            rost: {
                name: 'ROST',
                ticker: 'ROST',
                rating: 'BBB+',
                erpSystem: 'Oracle ERP Cloud',
                invoices: [
                    { id: 'INV-77814', amount: 567800.00, supplier: 'SUP-4489', supplierName: 'National Freight Systems', status: 'ready', risk: 99, yield: 6.20, hash: '0xBB334455', shipDate: '2026-01-07', deliveryConfirmed: true, oracle: { po: 'PO-75401', gr: 'GR-601001', amount: 567800.00, terms: 'NET 30', due: '2026-01-31' }, supplier_data: { po: 'PO-75401', gr: 'GR-601001', amount: 567800.00, terms: 'NET 30', due: '2026-01-31' }},
                    { id: 'INV-77815', amount: 489230.00, supplier: 'SUP-4489', supplierName: 'National Freight Systems', status: 'ready', risk: 98, yield: 6.40, hash: '0xDD556677', shipDate: '2026-01-09', deliveryConfirmed: true, oracle: { po: 'PO-75402', gr: 'GR-601002', amount: 489230.00, terms: 'NET 45', due: '2026-02-08' }, supplier_data: { po: 'PO-75402', gr: 'GR-601002', amount: 489230.00, terms: 'NET 45', due: '2026-02-08' }},
                    { id: 'INV-77816', amount: 398450.00, supplier: 'SUP-4489', supplierName: 'National Freight Systems', status: 'ready', risk: 98, yield: 6.50, hash: '0x44001133', shipDate: '2026-01-11', deliveryConfirmed: true, oracle: { po: 'PO-75403', gr: 'GR-601003', amount: 398450.00, terms: 'NET 30', due: '2026-02-01' }, supplier_data: { po: 'PO-75403', gr: 'GR-601003', amount: 398450.00, terms: 'NET 30', due: '2026-02-01' }},
                    { id: 'INV-77817', amount: 523100.00, supplier: 'SUP-4489', supplierName: 'National Freight Systems', status: 'ready', risk: 99, yield: 6.30, hash: '0xAA667799', shipDate: '2026-01-13', deliveryConfirmed: true, oracle: { po: 'PO-75404', gr: 'GR-601004', amount: 523100.00, terms: 'NET 45', due: '2026-02-12' }, supplier_data: { po: 'PO-75404', gr: 'GR-601004', amount: 523100.00, terms: 'NET 45', due: '2026-02-12' }}
                ]
            }
        };

        let currentObligor = 'tjx';
        let selectedInvoice = null;

        // Clock
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').textContent = now.toLocaleString('en-US', {
                month: '2-digit', day: '2-digit', year: 'numeric',
                hour: '2-digit', minute: '2-digit', second: '2-digit',
                hour12: true, timeZoneName: 'short'
            });
        }
        setInterval(updateClock, 1000);
        updateClock();

        // Select Obligor
        function selectObligor(obligorId) {
            currentObligor = obligorId;
            selectedInvoice = null;

            document.querySelectorAll('.obligor-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.obligor === obligorId);
            });

            document.getElementById('erp-system-label').textContent = obligorData[currentObligor].erpSystem;
            renderInvoiceList();
            clearComparison();
        }

        // Render Invoice List
        function renderInvoiceList() {
            const invoices = obligorData[currentObligor].invoices;
            document.getElementById('invoice-count').textContent = invoices.length;

            document.getElementById('invoice-list').innerHTML = invoices.map((inv, idx) => `
                <div class="invoice-item ${inv.status === 'mismatch' ? 'mismatch' : ''} ${inv.status === 'pending' ? 'pending' : ''}"
                     data-index="${idx}" onclick="selectInvoice(${idx})">
                    <div class="invoice-item-left">
                        <div class="invoice-id">${inv.id}</div>
                        <div class="invoice-supplier">${inv.supplier}</div>
                    </div>
                    <div class="invoice-item-right">
                        <div class="invoice-amount">$${inv.amount.toLocaleString('en-US', {minimumFractionDigits: 0})}</div>
                        <div class="invoice-status-badge ${inv.status}">${inv.status === 'ready' ? 'READY' : inv.status === 'mismatch' ? 'MISMATCH' : 'PENDING'}</div>
                    </div>
                </div>
            `).join('');
        }

        // Select Invoice
        function selectInvoice(index) {
            const invoices = obligorData[currentObligor].invoices;
            selectedInvoice = invoices[index];

            document.querySelectorAll('.invoice-item').forEach((item, idx) => {
                item.classList.toggle('selected', idx === index);
            });

            renderComparison();
        }

        // Clear Comparison
        function clearComparison() {
            document.getElementById('comparison-grid').innerHTML = `
                <div class="comparison-empty">Select an invoice to view triple verification</div>
            `;
            document.getElementById('verification-badge').className = 'verification-badge';
            document.getElementById('match-status-text').textContent = 'SELECT INVOICE';
            document.getElementById('verification-summary').style.display = 'none';
            document.getElementById('invoice-meta').style.display = 'none';
            document.getElementById('verify-btn').disabled = true;
        }

        // Render Comparison
        function renderComparison() {
            if (!selectedInvoice) return;

            const oracle = selectedInvoice.oracle;
            const supplier = selectedInvoice.supplier_data;
            const hasMismatch = selectedInvoice.status === 'mismatch';

            const categories = [
                { label: 'DOCUMENT IDENTITY', fields: [
                    { label: 'Invoice Number', oracle: selectedInvoice.id, supplier: selectedInvoice.id },
                    { label: 'Supplier ID', oracle: selectedInvoice.supplier, supplier: selectedInvoice.supplier }
                ]},
                { label: 'PROCUREMENT CHAIN', fields: [
                    { label: 'PO Reference', oracle: oracle.po, supplier: supplier.po },
                    { label: 'Goods Receipt', oracle: oracle.gr, supplier: supplier.gr }
                ]},
                { label: 'FINANCIAL DATA', fields: [
                    { label: 'Amount', oracle: '$' + oracle.amount.toLocaleString('en-US', {minimumFractionDigits: 2}), supplier: '$' + supplier.amount.toLocaleString('en-US', {minimumFractionDigits: 2}) },
                    { label: 'Currency', oracle: 'USD', supplier: 'USD' }
                ]},
                { label: 'PAYMENT TERMS', fields: [
                    { label: 'Terms', oracle: oracle.terms, supplier: supplier.terms },
                    { label: 'Due Date', oracle: oracle.due, supplier: supplier.due }
                ]},
                { label: 'LOGISTICS', fields: [
                    { label: 'Ship Date', oracle: selectedInvoice.shipDate, supplier: selectedInvoice.shipDate },
                    { label: 'Delivery', oracle: selectedInvoice.deliveryConfirmed ? 'CONFIRMED' : 'PENDING', supplier: selectedInvoice.deliveryConfirmed ? 'CONFIRMED' : 'PENDING' }
                ]}
            ];

            let totalFields = 0;
            let matchedFields = 0;
            let gridHTML = '';

            categories.forEach(cat => {
                gridHTML += `<div class="comparison-category"><div class="category-label">${cat.label}</div></div>`;
                cat.fields.forEach(f => {
                    const isMatch = f.oracle === f.supplier;
                    totalFields++;
                    if (isMatch) matchedFields++;

                    gridHTML += `
                        <div class="comparison-row">
                            <div class="comparison-cell oracle">
                                <div class="comparison-field">${f.label}</div>
                                <div class="comparison-value">${f.oracle}</div>
                            </div>
                            <div class="comparison-cell match-cell">
                                <div class="match-indicator ${isMatch ? 'pass' : 'fail'}">${isMatch ? '✓' : '✗'}</div>
                            </div>
                            <div class="comparison-cell supplier">
                                <div class="comparison-field">${f.label}</div>
                                <div class="comparison-value">${f.supplier}</div>
                            </div>
                        </div>
                    `;
                });
            });

            document.getElementById('comparison-grid').innerHTML = gridHTML;

            // Update verification badge
            const badge = document.getElementById('verification-badge');
            badge.className = 'verification-badge ' + (hasMismatch ? 'mismatch' : 'matched');
            document.getElementById('match-status-text').textContent = hasMismatch ? `${matchedFields}/${totalFields} MISMATCH` : `${matchedFields}/${totalFields} MATCH`;

            // Show verification summary
            document.getElementById('verification-summary').style.display = 'grid';

            const erpCheck = document.getElementById('erp-check');
            const ediCheck = document.getElementById('edi-check');
            const procurementCheck = document.getElementById('procurement-check');

            erpCheck.textContent = '✓';
            erpCheck.classList.add('confirmed');
            document.getElementById('erp-detail').textContent = `Invoice ${selectedInvoice.id} exists in ${obligorData[currentObligor].erpSystem}`;

            ediCheck.textContent = hasMismatch ? '!' : '✓';
            ediCheck.classList.toggle('confirmed', !hasMismatch);
            document.getElementById('edi-detail').textContent = hasMismatch ? 'Amount discrepancy: $500.00' : `EDI 810 confirmed by ${selectedInvoice.supplier}`;

            procurementCheck.textContent = '✓';
            procurementCheck.classList.add('confirmed');
            document.getElementById('procurement-detail').textContent = `${oracle.po} → ${oracle.gr} → ${selectedInvoice.id}`;

            // Show invoice meta
            document.getElementById('invoice-meta').style.display = 'flex';
            document.getElementById('meta-risk').textContent = selectedInvoice.risk;
            document.getElementById('meta-yield').textContent = selectedInvoice.yield.toFixed(2) + '%';
            document.getElementById('meta-hash').textContent = selectedInvoice.hash;

            // Enable verify button
            document.getElementById('verify-btn').disabled = false;
        }

        // Open Checkpoint with invoice data
        function openCheckpoint() {
            if (!selectedInvoice) return;

            const params = new URLSearchParams({
                po: selectedInvoice.oracle.po,
                inv: selectedInvoice.id,
                obligor: obligorData[currentObligor].ticker,
                supplier: selectedInvoice.supplier,
                amount: selectedInvoice.amount
            });

            window.location.href = `checkpoint.html?${params.toString()}`;
        }

        // Initialize
        renderInvoiceList();
    </script>
</body>
</html>
